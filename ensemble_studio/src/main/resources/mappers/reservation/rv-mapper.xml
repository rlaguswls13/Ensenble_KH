<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="rvMapper">
	<!-- RvPagination용 resultMap -->
	<resultMap type="RvPagination" id="rvpg_rm">
		<result property="rvListCount" column="CNT" />
		<result property="memberNo" column="MEMBER_NO" />

	</resultMap>


	<resultMap type="Rv" id="rv_rm">
		<!-- 기본키(PK)에 해당하는 컬럼, 필드 매핑 -->
		<id property="rvNo" column="RV_NO" />

		<!-- 기본키 외의 컬럼, 필드 매핑 -->
		<result property="memberNo" column="MEMBER_NO" />
		<result property="roomNo" column="ROOM_NO" />
		<result property="rvDate" column="RV_DATE" />
		<result property="rvTime" column="RV_TIME" />
		<result property="rvPeople" column="RV_PEOPLE" />
		<result property="rvCars" column="RV_CARS" />
		<result property="rvAnimals" column="RV_ANIMALS" />
		<result property="rvPurpose" column="RV_PURPOSE" />
		<result property="rvEtc" column="RV_ETC" />
		<collection property="optionList" column="RV_NO"
			javaType="java.util.List" ofType="Option" select="selectOptionList">
			<!-- 옵션리스트를 얻어오는데 사용할값 -->
			<!-- 예약하나에 대한 상품리스트를 만들어서 (rv라는 객체로 나가지고 -->

		</collection>
	</resultMap>


	<resultMap type="Option" id="option_rm">
		<!-- 기본키(PK)에 해당하는 컬럼, 필드 매핑 -->
		<id property="optionNo" column="OPTION_NO" />

		<!-- 기본키 외의 컬럼, 필드 매핑 -->
		<result property="optionName" column="OPTION_NAME" />
		<result property="optionType" column="OPTION_TYPE" />
		<result property="optionPrice" column="OPTION_PRICE" />


	</resultMap>





	<select id="getRvListCount" parameterType="_int"
		resultMap="rvpg_rm">
		SELECT
		CNT
		FROM (SELECT COUNT(*) CNT
		FROM RESERVATION
		WHERE
		MEMBER_NO = #{pg.getMemberNo() } )

	</select>

	<!-- 예약 목록 조회 -->
	<select id="selectRvList" parameterType="_int" resultMap="rv_rm">
		SELECT
		RV_NO, MEMBER_NO, ROOM_NO, RV_DATE, RV_TIME, RV_PEOPLE, RV_CARS, RV_ANIMALS,
		RV_PURPOSE,RV_ETC
		FROM RESERVATION
		WHERE
		MEMBER_NO = #{pagination.getMemberNo()}
		ORDER BY RV_NO DESC
	</select>
	
	<select id="selectOptionList" parameterType="_int"
		resultMap="option_rm">
		SELECT * FROM RESERVATION_OPTION
		JOIN STUDIO_OPTION USING (OPTION_NO)
		WHERE RV_NO = #{rvNo}


	</select>
	
	
	<!-- 예약 목록 조회 -->
	<select id="selectRvTimeList" parameterType="Rv" resultMap="rv_rm">
		SELECT
		RV_TIME
		FROM RESERVATION
		WHERE RV_DATE = #{rvDate}
		AND ROOM_NO = #{roomNo}
		
	</select>
	


</mapper>